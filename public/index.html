<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini 3 Pro Image Tool (Zeabur)</title>
    <style>
        body { font-family: -apple-system, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: #1a1a1a; color: #fff; }
        .container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: #2d2d2d; padding: 20px; border-radius: 12px; }
        textarea { width: 100%; height: 100px; background: #333; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 6px; box-sizing: border-box; }
        button { background: #0070f3; color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; margin-top: 10px; font-weight: bold; }
        button:hover { background: #0051a2; }
        button:disabled { background: #444; cursor: wait; }
        img { width: 100%; border-radius: 8px; display: none; margin-top: 10px; }
        pre { background: #111; padding: 10px; border-radius: 6px; overflow-x: auto; font-size: 12px; color: #0f0; max-height: 400px; overflow-y: auto; }
        .label { font-size: 0.8rem; color: #888; margin-bottom: 5px; display: block; }
        
        @media (max-width: 700px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <h1>ğŸš€ Gemini 3 Pro åœ–åƒç”Ÿæˆå™¨</h1>
    
    <div class="container">
        <!-- å·¦å´ï¼šæ§åˆ¶é¢æ¿ -->
        <div class="card">
            <span class="label">æç¤ºè© (Prompt)</span>
            <textarea id="prompt" placeholder="ä¾‹å¦‚ï¼šA futuristic city made of crystal, 8k resolution...">Cyberpunk street at night, neon lights, realistic, 8k</textarea>
            
            <button id="btn" onclick="generate()">ç”Ÿæˆåœ–ç‰‡ (Generate)</button>
            
            <div id="status" style="margin-top:10px; color: #aaa;">æº–å‚™å°±ç·’</div>
        </div>

        <!-- å³å´ï¼šçµæœå±•ç¤º -->
        <div class="card">
            <span class="label">ç”Ÿæˆçµæœ</span>
            <img id="outputImage" alt="Generated Image" />
        </div>
    </div>

    <!-- åº•éƒ¨ï¼šAPI åŸå§‹è¼¸å‡º (Debug) -->
    <div class="card" style="margin-top: 20px;">
        <span class="label">API å®Œæ•´å›æ‡‰ (Debug Info)</span>
        <pre id="apiOutput">// é€™è£¡å°‡é¡¯ç¤ºå®Œæ•´çš„ API JSON å›æ‡‰...</pre>
    </div>

    <script>
        async function generate() {
            const prompt = document.getElementById('prompt').value;
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            const img = document.getElementById('outputImage');
            const apiOut = document.getElementById('apiOutput');

            if (!prompt) return;

            // UI ç‹€æ…‹æ›´æ–°
            btn.disabled = true;
            status.innerText = "â³ è«‹æ±‚å¾Œç«¯ API ä¸­...";
            img.style.display = 'none';
            apiOut.innerText = "Loading...";

            try {
                // ç™¼é€åˆ°æˆ‘å€‘è‡ªå·±çš„å¾Œç«¯ (server.js)
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            responseModalities: ["IMAGE"],
                            imageConfig: { aspectRatio: "16:9", imageCount: 1 }
                        }
                    })
                });

                const data = await response.json();
                
                // é¡¯ç¤ºåŸå§‹ JSON
                apiOut.innerText = JSON.stringify(data, null, 2);
                status.innerText = `è«‹æ±‚å®Œæˆ (Status: ${response.status})`;

                // å˜—è©¦è§£æåœ–ç‰‡
                if (data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data) {
                    const b64 = data.candidates[0].content.parts[0].inlineData.data;
                    img.src = `data:image/png;base64,${b64}`;
                    img.style.display = 'block';
                } else {
                    status.innerText = "âš ï¸ ç”Ÿæˆå¤±æ•—æˆ–ç„¡åœ–ç‰‡æ•¸æ“š";
                }

            } catch (e) {
                status.innerText = "âŒ ç™¼ç”ŸéŒ¯èª¤";
                apiOut.innerText = "Error: " + e.message;
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
